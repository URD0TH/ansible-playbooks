---
- name: Actualizar paquetes del sistema y reiniciar
  hosts: all
  become: yes

  tasks:
    - name: Actualizar todos los paquetes del sistema
      apt:
        update_cache: yes
        upgrade: yes
      register: update_result

    - name: Reiniciar el servidor
      reboot:
        reboot_timeout: 300
        test_command: uptime
      register: reboot_result

    - name: Enviar notificaci√≥n si la actualizaci√≥n tuvo √©xito
      uri:
        url: "http://ntfy.hc.bnds.link/upgrade"
        method: POST
        body: "Actualizaci√≥n tuvo √©xito üòÄ"
        status_code: 200
      when: update_result.changed

    - name: Enviar notificaci√≥n si hubo un error en la actualizaci√≥n
      uri:
        url: "http://ntfy.hc.bnds.link/upgrade"
        method: POST
        body: "Error al actualizar paquetes üòü"
        status_code: 200
      when: update_result.failed

    - name: Enviar notificaci√≥n si el reinicio tuvo √©xito
      uri:
        url: "http://ntfy.hc.bnds.link/upgrade"
        method: POST
        body: "reinicio exitoso üòÄ"
        status_code: 200
      when: reboot_result.changed

    - name: Enviar notificaci√≥n si hubo un error en el reinicio
      uri:
        url: "http://ntfy.hc.bnds.link/upgrade"
        method: POST
        body: "Error al reiniciar el servidor ‚ùå"
        status_code: 200
      when: reboot_result.failed
